{% extends 'base.html' %}

{% block title %}Pagamento Seguro{% endblock %}

{% block content %}
<div class="checkout-container">
    <div class="checkout-wrapper">
        
        <div class="order-summary">
            <h3>Resumo do Pedido</h3>
            <div class="summary-card">
                <div class="plan-row">
                    <span>Plano Escolhido</span>
                    <strong style="font-size: 1.2rem;">{{ plan_type }}</strong>
                </div>
                <div class="plan-row">
                    <span>Valor Total</span>
                    <strong class="total-price">R$ {{ price }}</strong>
                </div>
            </div>
            
            <ul class="security-badges">
                <li><i class="fas fa-lock"></i> Ambiente 100% Seguro</li>
                <li><i class="fas fa-shield-alt"></i> Dados Criptografados</li>
                <li><i class="fas fa-bolt"></i> Liberação Imediata</li>
            </ul>
        </div>

        <div class="payment-box">
            <h2>Forma de Pagamento</h2>
            
            <div class="payment-tabs">
                <button class="tab-btn active" onclick="switchMethod('card')">
                    <i class="far fa-credit-card"></i> Cartão de Crédito
                </button>
                <button class="tab-btn" onclick="switchMethod('pix')">
                    <i class="fab fa-pix"></i> PIX (Instantâneo)
                </button>
            </div>

            <form action="{% url 'process_payment' %}" method="POST" id="checkoutForm" onsubmit="return simulateLoading(event)">
                {% csrf_token %}
                <input type="hidden" name="plan_type" value="{{ plan_type }}">

                <div id="card-section">
                    <div class="form-group">
                        <label>Número do Cartão</label>
                        <input type="text" placeholder="0000 0000 0000 0000" maxlength="19" required class="input-field">
                    </div>
                    <div class="form-group">
                        <label>Nome no Cartão</label>
                        <input type="text" placeholder="Ex: JOAO DA SILVA" required class="input-field">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Validade</label>
                            <input type="text" placeholder="MM/AA" maxlength="5" required class="input-field">
                        </div>
                        <div class="form-group">
                            <label>CVV</label>
                            <input type="text" placeholder="123" maxlength="3" required class="input-field">
                        </div>
                    </div>
                </div>

                <div id="pix-section" style="display: none; text-align: center; padding: 20px;">
                    <p style="margin-bottom: 15px; font-weight: bold;">Escaneie o QR Code abaixo:</p>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg" alt="QR Code Fake" style="width: 160px; margin-bottom: 20px; opacity: 0.8;">
                    
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.9rem; color: #555; word-break: break-all;">
                        00020126580014BR.GOV.BCB.PIX0136123e4567-e89b-12d3-a456-426614174000
                    </div>
                    <p style="color: #666; font-size: 0.8rem; margin-top: 10px;">O pagamento será aprovado automaticamente após o pagamento.</p>
                </div>

                <button type="submit" class="btn-pay" id="payButton">
                    Confirmar Pagamento de R$ {{ price }}
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    .checkout-container { padding: 140px 20px 80px; background: #f4f7f6; min-height: 100vh; }
    .checkout-wrapper { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1.6fr; gap: 30px; }
    
    @media(max-width: 768px) { .checkout-wrapper { grid-template-columns: 1fr; } }

    /* Resumo */
    .order-summary { background: #0056b3; color: white; padding: 30px; border-radius: 15px; height: fit-content; }
    .summary-card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px; }
    .plan-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
    .plan-row:last-child { border: none; margin: 0; padding: 0; }
    .total-price { font-size: 1.5rem; color: #ffdd57; }
    
    .security-badges { list-style: none; padding: 0; margin-top: 30px; font-size: 0.9rem; opacity: 0.9; }
    .security-badges li { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }

    /* Pagamento */
    .payment-box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
    .payment-tabs { display: flex; gap: 10px; margin-bottom: 30px; }
    .tab-btn { flex: 1; padding: 12px; border: 2px solid #eee; background: white; cursor: pointer; border-radius: 8px; font-weight: bold; color: #555; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .tab-btn.active { border-color: #0056b3; color: #0056b3; background: #eef6fc; }
    
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 0.9rem; }
    .input-field { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: 0.3s; }
    .input-field:focus { border-color: #0056b3; outline: none; box-shadow: 0 0 0 3px rgba(0,86,179,0.1); }
    .form-row { display: flex; gap: 20px; }

    .btn-pay { width: 100%; background: #27ae60; color: white; padding: 16px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 20px; }
    .btn-pay:hover { background: #219150; transform: translateY(-2px); }
</style>

<script>
    function switchMethod(method) {
        const cardSection = document.getElementById('card-section');
        const pixSection = document.getElementById('pix-section');
        const btns = document.querySelectorAll('.tab-btn');
        const inputs = cardSection.querySelectorAll('input');

        if (method === 'card') {
            cardSection.style.display = 'block';
            pixSection.style.display = 'none';
            btns[0].classList.add('active');
            btns[1].classList.remove('active');
            inputs.forEach(input => input.required = true);
        } else {
            cardSection.style.display = 'none';
            pixSection.style.display = 'block';
            btns[0].classList.remove('active');
            btns[1].classList.add('active');
            inputs.forEach(input => input.required = false);
        }
    }

    function simulateLoading(event) {
        const btn = document.getElementById('payButton');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        // Permite o envio real do formulário
        return true; 
    }
</script>
{% endblock %}