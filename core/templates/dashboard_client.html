{% extends 'base.html' %}
{% load static %}

{% block title %}Painel do Cliente{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="container">

        {% if not user.profile.has_active_plan %}
            <div class="welcome-container">
                <h1 class="welcome-title">Bem-vindo, {{ user.first_name }}! ðŸ‘‹</h1>
                <p style="color: red;">DEBUG: {{ appointments }}</p>
                <p class="welcome-subtitle">Para acessar a agenda completa dos especialistas, escolha seu plano ideal:</p>

                <div class="plans-preview-grid">
                    <div class="plan-preview-card">
                        <h3>BÃ¡sico</h3>
                        <div class="price">R$ 29<span>,90</span> <small>/mÃªs</small></div>
                        <ul>
                            <li><i class="fas fa-check"></i> Ver agenda completa</li>
                            <li><i class="fas fa-check"></i> Agendamento liberado</li>
                        </ul>
                        <a href="{% url 'checkout' 'Basico' '29.90' %}" class="btn-select btn-outline">Assinar Agora</a>
                    </div>

                    <div class="plan-preview-card popular">
                        <div class="badge-pop">Recomendado</div>
                        <h3>Premium</h3>
                        <div class="price">R$ 59<span>,90</span> <small>/trimestre</small></div>
                        <ul>
                            <li><i class="fas fa-check"></i> Tudo do BÃ¡sico</li>
                            <li><i class="fas fa-check"></i> Suporte PrioritÃ¡rio</li>
                        </ul>
                        <a href="{% url 'checkout' 'Premium' '59.90' %}" class="btn-select btn-primary">Assinar Agora</a>
                    </div>

                    <div class="plan-preview-card">
                        <h3>Empresarial</h3>
                        <div class="price">R$ 149<span>,90</span> <small>/ano</small></div>
                        <ul>
                            <li><i class="fas fa-check"></i> MÃºltiplos usuÃ¡rios</li>
                            <li><i class="fas fa-check"></i> Gerente de conta</li>
                        </ul>
                        <a href="{% url 'checkout' 'Empresarial' '149.90' %}" class="btn-select btn-outline">Assinar Agora</a>
                    </div>
                </div>
            </div>

        {% else %}

            <div class="dashboard-section-header">
                <h2><i class="far fa-calendar-check"></i> Meus Agendamentos</h2>
                <a href="{% url 'home' %}#experts" class="btn-new-appointment">
                    <i class="fas fa-plus"></i> Nova Consulta
                </a>
            </div>

            <div class="appointments-grid">
                {% for appt in appointments %}
                    <div class="appointment-card">
                        <div class="date-box">
                            <span class="day">{{ appt.date|date:"d" }}</span>
                            <span class="month">{{ appt.date|date:"M" }}</span>
                        </div>

                        <div class="appt-details">
                            <div class="specialist-row">
                                {% if appt.specialist.photo %}
                                    <img src="{{ appt.specialist.photo.url }}" class="mini-avatar">
                                {% else %}
                                    <div class="mini-no-photo"><i class="fas fa-user"></i></div>
                                {% endif %}
                                <div>
                                    <h4>{{ appt.specialist.user.first_name }}</h4>
                                    <span class="profession-tag">{{ appt.specialist.get_profession_display }}</span>
                                </div>
                            </div>

                            <div class="time-row">
                                <span><i class="far fa-clock"></i> {{ appt.time|time:"H:i" }}</span>
                                <span class="status-confirmed"><i class="fas fa-check-circle"></i> Confirmado</span>
                            </div>
                        </div>

                        <div class="card-action">
                            <a href="{% url 'home' %}#contact" class="btn-icon-cancel" title="Solicitar alteraÃ§Ã£o ou cancelamento">
                                <i class="fas fa-ellipsis-v"></i>
                            </a>
                        </div>
                    </div>
                {% empty %}
                    <div class="empty-state-card">
                        <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" alt="Sem agendamentos">
                        <h3>Nenhuma consulta agendada</h3>
                        <p>Aproveite seu plano e marque seu primeiro atendimento agora mesmo.</p>
                        <a href="{% url 'home' %}#experts" class="btn-cta-empty">Ver Especialistas</a>
                    </div>
                {% endfor %}
            </div>

            <div class="divider-section"></div>

            <div class="dashboard-section-header">
                <h2><i class="fas fa-user-md"></i> Profissionais DisponÃ­veis</h2>
                <a href="{% url 'home' %}" class="link-view-all">Ver Todos <i class="fas fa-arrow-right"></i></a>
            </div>

            <div class="specialists-carousel">
                {% for spec in specialists|slice:":4" %}
                    <a href="{% url 'specialist_detail' spec.id %}" class="mini-spec-card">
                        <div class="spec-img-wrapper">
                            {% if spec.photo %}
                                <img src="{{ spec.photo.url }}" alt="{{ spec.user.first_name }}">
                            {% else %}
                                <div class="no-photo-mini"><i class="fas fa-user"></i></div>
                            {% endif %}
                            <span class="status-dot"></span>
                        </div>
                        <h4>{{ spec.user.first_name }}</h4>
                        <p>{{ spec.get_profession_display }}</p>
                    </a>
                {% empty %}
                    <p class="text-muted">Nenhum profissional disponÃ­vel no momento.</p>
                {% endfor %}
            </div>

        {% endif %}

    </div>
</div>

<style>
    /* --- ESTRUTURA GERAL --- */
    .dashboard-container { padding-top: 110px; padding-bottom: 80px; background-color: #f8f9fa; min-height: 100vh; }

    /* Welcome / Sem Plano */
    .welcome-container { text-align: center; max-width: 900px; margin: 0 auto; }
    .welcome-title { color: #1c548c; font-size: 2.2rem; font-weight: 800; margin-bottom: 10px; }
    .welcome-subtitle { color: #666; font-size: 1.1rem; margin-bottom: 40px; }

    /* Cards de Plano (Preview) */
    .plans-preview-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
    .plan-preview-card { background: white; padding: 30px; border-radius: 12px; width: 260px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #eee; position: relative; transition: 0.3s; }
    .plan-preview-card:hover { transform: translateY(-5px); }
    .plan-preview-card.popular { border: 2px solid #1c548c; transform: scale(1.05); }
    .badge-pop { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #1c548c; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }

    .plan-preview-card h3 { font-size: 1.4rem; color: #333; margin-bottom: 10px; }
    .plan-preview-card .price { font-size: 2rem; font-weight: 800; color: #1c548c; margin-bottom: 20px; }
    .plan-preview-card .price small { font-size: 0.9rem; color: #999; font-weight: normal; }
    .plan-preview-card ul { list-style: none; padding: 0; text-align: left; margin-bottom: 25px; }
    .plan-preview-card li { margin-bottom: 8px; color: #555; font-size: 0.9rem; display: flex; gap: 8px; }
    .plan-preview-card li i { color: #27ae60; }

    .btn-select { display: block; width: 100%; padding: 10px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: 0.3s; }
    .btn-outline { border: 1px solid #1c548c; color: #1c548c; }
    .btn-outline:hover { background: #f0f4f8; }
    .btn-primary { background: #1c548c; color: white; }
    .btn-primary:hover { background: #15416d; }

    /* --- DASHBOARD CLIENTE (AGENDAMENTOS) --- */
    .dashboard-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .dashboard-section-header h2 { font-size: 1.5rem; color: #333; margin: 0; }

    .btn-new-appointment { background: #1c548c; color: white; padding: 10px 20px; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 0.9rem; box-shadow: 0 4px 10px rgba(28, 84, 140, 0.2); transition: 0.3s; }
    .btn-new-appointment:hover { transform: translateY(-2px); background: #15416d; }

    /* GRID DE CARDS */
    .appointments-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }

    .appointment-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        border: 1px solid #eee;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .appointment-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.06); border-color: #dbeafe; }

    /* Data Visual */
    .date-box {
        background: #eef6fc;
        color: #1c548c;
        border-radius: 10px;
        min-width: 65px;
        height: 65px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    .date-box .day { font-size: 1.6rem; font-weight: 800; line-height: 1; }
    .date-box .month { font-size: 0.75rem; text-transform: uppercase; font-weight: 700; }

    /* Detalhes */
    .appt-details { flex-grow: 1; }
    .specialist-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .mini-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
    .mini-no-photo { width: 35px; height: 35px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; color: #999; font-size: 0.8rem; }
    .specialist-row h4 { margin: 0; font-size: 1rem; color: #333; font-weight: 600; }
    .profession-tag { font-size: 0.7rem; color: #666; background: #f5f5f5; padding: 2px 6px; border-radius: 4px; }

    .time-row { display: flex; gap: 15px; font-size: 0.85rem; color: #555; }
    .status-confirmed { color: #27ae60; font-weight: 600; }

    /* AÃ§Ã£o (Menu) */
    .btn-icon-cancel { color: #ccc; padding: 5px; transition: 0.2s; }
    .btn-icon-cancel:hover { color: #1c548c; }

    /* Empty State */
    .empty-state-card { grid-column: 1 / -1; background: white; padding: 50px; text-align: center; border-radius: 12px; border: 2px dashed #eee; }
    .empty-state-card img { width: 100px; opacity: 0.6; margin-bottom: 20px; }
    .empty-state-card h3 { color: #333; margin-bottom: 5px; }
    .empty-state-card p { color: #888; margin-bottom: 20px; }
    .btn-cta-empty { display: inline-block; background: #27ae60; color: white; padding: 10px 25px; border-radius: 50px; text-decoration: none; font-weight: bold; transition: 0.3s; }
    .btn-cta-empty:hover { background: #219150; transform: scale(1.05); }

    /* Divisor */
    .divider-section { height: 1px; background: #eee; margin: 50px 0; }

    /* Carrossel Mini de Especialistas */
    .specialists-carousel { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
    .mini-spec-card { background: white; padding: 15px; border-radius: 10px; text-align: center; text-decoration: none; border: 1px solid #eee; transition: 0.3s; }
    .mini-spec-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-color: #1c548c; }

    .spec-img-wrapper { position: relative; width: 60px; height: 60px; margin: 0 auto 10px; }
    .spec-img-wrapper img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
    .no-photo-mini { width: 100%; height: 100%; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; color: #999; font-size: 1.5rem; }
    .status-dot { width: 12px; height: 12px; background: #27ae60; border: 2px solid white; border-radius: 50%; position: absolute; bottom: 0; right: 0; }

    .mini-spec-card h4 { margin: 0; font-size: 0.95rem; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .mini-spec-card p { margin: 2px 0 0; font-size: 0.75rem; color: #888; }
    .link-view-all { font-size: 0.9rem; color: #1c548c; text-decoration: none; font-weight: 600; }
    .link-view-all:hover { text-decoration: underline; }

    @media (max-width: 768px) {
        .dashboard-header { flex-direction: column; text-align: center; gap: 15px; }
        .appointments-grid { grid-template-columns: 1fr; }
        .specialists-carousel { grid-template-columns: repeat(2, 1fr); }
    }
</style>
{% endblock %}